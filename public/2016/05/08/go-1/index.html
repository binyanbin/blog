<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> golang是不是后端开发神器 · 码工严彬 coding不仅仅是工作</title><meta name="description" content="golang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="https://github.com/binyanbin" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/2015/12/20/self-introduce/" target="_self" class="nav-list-link">INDEX</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">golang是不是后端开发神器</h1><div class="post-meta"><div class="post-time">2016年5月8日</div></div><div class="post-content"><p>周末有人介绍golang很合适后端开发，随即把之前C实现的静态资源下载功能(读取服务器上的静态资源文件内容返回给客户端)改成golang实现。然后对比一下效果。</p>
<h2 id="实现对比"><a href="#实现对比" class="headerlink" title="实现对比"></a>实现对比</h2><p>同样使用标准库,golang实现代码+注释只需要123行,C实现代码+注释412行，golang代码量只有C的1/3。</p>
<h2 id="测试对比"><a href="#测试对比" class="headerlink" title="测试对比"></a>测试对比</h2><p>我使用的是jmeter测试，首先测试c实现的服务,分别用100,200,300线程并发，每线程访问10。测试数据如下:<br><img src="/img/go-1.png" alt="c"></p>
<p><img src="/img/go-2.png" alt="c"></p>
<p><img src="/img/go-3.png" alt="c"><br>C版实现越测数据越看不下去了，出错率越来越大。接着我测golang实现，我分别用300线程，1000线程和5000线程并发，每线程访问10次。测试数据如下:<br><img src="/img/go-4.png" alt="c"></p>
<p><img src="/img/go-5.png" alt="c"></p>
<p><img src="/img/go-6.png" alt="c"><br>除了响应时间延长，其它都比较稳定，出错率全为0.难道这是传说中的后端神器，难道老板再也不用担心网站访问人数太多当机了，难道我也转golang开发。<br><a id="more"></a></p>
<h2 id="golang实现"><a href="#golang实现" class="headerlink" title="golang实现"></a>golang实现</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"flag"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"io/ioutil"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"os/exec"</span></span><br><span class="line">	<span class="string">"path/filepath"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> realPath <span class="keyword">string</span> <span class="comment">//当前程序运行目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line">www路由，请求处理 w:response  r:request</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">staticResource</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"url:"</span> + r.RequestURI)</span><br><span class="line">	<span class="keyword">if</span> r.Method == <span class="string">"get"</span> || r.Method == <span class="string">"GET"</span> &#123;</span><br><span class="line">		disposeGet(w, r)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> r.Method == <span class="string">"post"</span> || r.Method == <span class="string">"POST"</span> &#123;</span><br><span class="line">		disposePost(w, r)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		w.WriteHeader(<span class="number">501</span>)</span><br><span class="line">		w.Write([]<span class="keyword">byte</span>(<span class="string">"&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Method Not Implemented&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;&lt;P&gt;HTTP request method not supported.&lt;/BODY&gt;&lt;/HTML&gt;"</span>))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line">取字串 s:字符串 l:取到多少位</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">substr</span><span class="params">(s <span class="keyword">string</span>, l <span class="keyword">int</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(s) &lt;= l &#123;</span><br><span class="line">		<span class="keyword">return</span> s</span><br><span class="line">	&#125;</span><br><span class="line">	ss, sl, rl, rs := <span class="string">""</span>, <span class="number">0</span>, <span class="number">0</span>, []<span class="keyword">rune</span>(s)</span><br><span class="line">	<span class="keyword">for</span> _, r := <span class="keyword">range</span> rs &#123;</span><br><span class="line">		rint := <span class="keyword">int</span>(r)</span><br><span class="line">		<span class="keyword">if</span> rint &lt; <span class="number">128</span> &#123;</span><br><span class="line">			rl = <span class="number">1</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			rl = <span class="number">2</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> sl+rl &gt; l &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		sl += rl</span><br><span class="line">		ss += <span class="keyword">string</span>(r)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ss</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line">get获取静态资源 w: response r: request</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">disposeGet</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	request_type := r.URL.Path[strings.LastIndex(r.URL.Path, <span class="string">"."</span>):]</span><br><span class="line">	<span class="keyword">switch</span> request_type &#123; <span class="comment">//文件类型判断</span></span><br><span class="line">	<span class="keyword">case</span> <span class="string">".html"</span>:</span><br><span class="line">		w.Header().Set(<span class="string">"content-type"</span>, <span class="string">"text/html"</span>)</span><br><span class="line">	<span class="keyword">case</span> <span class="string">".htm"</span>:</span><br><span class="line">		w.Header().Set(<span class="string">"content-type"</span>, <span class="string">"text/html"</span>)</span><br><span class="line">	<span class="keyword">case</span> <span class="string">".css"</span>:</span><br><span class="line">		w.Header().Set(<span class="string">"content-type"</span>, <span class="string">"text/css"</span>)</span><br><span class="line">	<span class="keyword">case</span> <span class="string">".js"</span>:</span><br><span class="line">		w.Header().Set(<span class="string">"content-type"</span>, <span class="string">"text/javascript"</span>)</span><br><span class="line">	<span class="keyword">case</span> <span class="string">".png"</span>:</span><br><span class="line">		w.Header().Set(<span class="string">"content-type"</span>, <span class="string">"image/png"</span>)</span><br><span class="line">	<span class="keyword">case</span> <span class="string">".gif"</span>:</span><br><span class="line">		w.Header().Set(<span class="string">"content-type"</span>, <span class="string">"image/gif"</span>)</span><br><span class="line">	<span class="keyword">case</span> <span class="string">".jpg"</span>:</span><br><span class="line">		w.Header().Set(<span class="string">"content-type"</span>, <span class="string">"image/jpeg"</span>)</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">	&#125;</span><br><span class="line">	fin, err := os.Open(realPath + r.URL.Path)</span><br><span class="line">	<span class="keyword">defer</span> fin.Close()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123; <span class="comment">//未找到静态资源文件</span></span><br><span class="line">		<span class="keyword">if</span> request_type == <span class="string">".html"</span> || request_type == <span class="string">".htm"</span> &#123; <span class="comment">//未找到html文件</span></span><br><span class="line">			w.WriteHeader(<span class="number">404</span>)</span><br><span class="line">			fmt.Println(<span class="string">"static resource:"</span>, err)</span><br><span class="line">			w.Write([]<span class="keyword">byte</span>(<span class="string">"&lt;HTML&gt;&lt;TITLE&gt;Not Found&lt;/TITLE&gt;&lt;BODY&gt;&lt;P&gt;The server could not fulfill.your request be.is unavailable or nonexistent.&lt;/BODY&gt;&lt;/HTML&gt;"</span>))</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	fd, _ := ioutil.ReadAll(fin)</span><br><span class="line">	w.Write(fd)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line">post上传静态资源 w: response r: request</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">disposePost</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	<span class="comment">//未实现</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line">程序入口</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//获取程序当前路径</span></span><br><span class="line">	file, _ := exec.LookPath(os.Args[<span class="number">0</span>])</span><br><span class="line">	path, _ := filepath.Abs(file)</span><br><span class="line">	<span class="comment">//命令行参数处理</span></span><br><span class="line">	arg_num := <span class="built_in">len</span>(os.Args)</span><br><span class="line">	<span class="keyword">if</span> arg_num == <span class="number">2</span> &#123;</span><br><span class="line">		port := os.Args[<span class="number">1</span>] <span class="comment">//第一个参数为端口号</span></span><br><span class="line">		fmt.Println(<span class="string">"http server start port:"</span> + port)</span><br><span class="line">		<span class="comment">//取前当前目录</span></span><br><span class="line">		realPath = substr(path, strings.LastIndex(path, <span class="string">"\\"</span>))</span><br><span class="line">		flag.Parse()</span><br><span class="line">		<span class="comment">//请求处理</span></span><br><span class="line">		http.HandleFunc(<span class="string">"/www/"</span>, staticResource)</span><br><span class="line">		err := http.ListenAndServe(<span class="string">":"</span>+port, <span class="literal">nil</span>)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatal(<span class="string">"服务器出错:"</span>, err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"参数错误，程序退出"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div><div data-thread-key="2016/05/08/go-1/" data-title="golang是不是后端开发神器" data-url="http://binyanbin.github.io/2016/05/08/go-1/" class="ds-share flat"><div class="ds-share-inline"><div class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0)" class="ds-more">分享到:</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">QQ微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li><div class="ds-share-icons-more"></div></div></div></div></section><footer><div class="paginator"><a href="/2016/05/13/jmeter-2/" class="prev">上一篇</a><a href="/2016/05/06/english-1/" class="next">下一篇</a></div><div data-thread-key="2016/05/08/go-1/" data-title="golang是不是后端开发神器" data-url="http://binyanbin.github.io/2016/05/08/go-1/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"binyanbin"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2016 <a href="http://binyanbin.github.io">严彬</a>, unless otherwise noted.</p></div></footer><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?fcf7e8f303b6e03be86f5619636d0f7e";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>