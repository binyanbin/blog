---
title: jmeter 基础概念
date: 2016-3-12
desc: jmeter 概念
---

最近做性能优化工作，同时要给自己的工作给一个总结。需要自己弄性能测试及编写性能测试报告。在别人推荐下使用JMeter对项目进行性能测试。JMeter可以进行配置和执行负载测试、性能测试和压力测试的工具。了解一下几个概念:
* 负载测试: 这类测试使系统或者应用程序在预先设计好的极端场景下测试运行。这类测试用来评估系统或者程序在极端条件下的行为。
* 性能测试: 这种测试被用来检测系统的性能表现，包括特定情况下，系统的响应能力和稳定性。
* 压力测试: 这类测试通过载入更多的外部资源，并使系统组件超越其所设定的能力范围,试图使系统挂掉.
<!-- more -->
JMeter 的安装非常简单,从官方网站上下载，解压之后即可使用。运行命令在%JMETER_HOME%/bin下,对于 Windows用户来说,命令是jmeter.bat。运行前请检查JMeter的文档,查看是否具备相关的运行条件:JDK的版本要求是否满足.
## Test Plan配置
![基本配置](/img/jmeter-1.png)
进去之后，你会看到Test Plan和WorkBench。这两个块东西没有太多区别，不同的是Test Plan是测试的相关配置，workbench可以帮你创建一个代理服务器帮Test Plan录制测试脚本。
#### ThreadGroup 线程组
一个线程组基本上是不同的测试计划元素的组合，它是一个测试计划的核心，它控制着基本核心参数。
为了创建一个测试计划，首先你不得不去创建一个线程组，配置如下参数:线程数量，过渡时期，循环次数和正常情况或者错误情况下的行为：
#### Samplers 采样器
采样器用于发送请求到不同类型的服务器。它们是每一个测试计划的基本要素，一切都围绕这些采样器而工作：采样器执行请求，这些请求产生一个或多个响应，后续将被分析。
#### Logic Controllers 逻辑控制器
逻辑控制器允许你配置一个线程组内不同采样器的执行顺序。
#### Listeners 监听器
监听器提供不同的方式查看由采样器请求产生的结果。监听器以报表、树型结构、或简明的日志文件的形式分析结果。
#### Timers 定时器
定时器来定义请求之间的等待时间。如果不指定，JMeter会一个请求完成后立即执行下一个请求，没有任何等待时间。
#### Assertions 断言
断言通过验证采样器请求产生的响应，来验证测试计划的有效性。类似于单元测试断言，用来检测被测试应用程序的响应质量。
#### Configuration nodes 配置节点
配置节点可以将不同的参数传递给取样器请求。
#### Pre processors 前置处理器
前置处理器在采样器执行前被触发的元素。
#### Post processors 后置处理器
后置处理器是取样器被执行后被触发执行的元素。

## WorkBench
![非测试元素](/img/jmeter-2.png)
WorkBench可以Add三个Non-test Elements:
* Http Mirror Server 镜像的服务器
其实就是一个代理服务器,它把所有接收到的请求原封不动地返回，这样就可以看到发出请求和响应的具体内容了。
* Http(s) Test Script Recorder 脚本录制器
也是一个代理服务器,它会把所有接受的请求全部记录到Test Plan配置中,你在测试中可以使用这些录制的脚本。

## 测试计划元素执行顺序
* 配置节点
* 前置处理器
* 定时器
* 取样器
* 后置处理器（只在有结果可用情况下执行）
* 断言（只在有结果可用情况下执行）
* 监听器（只在有结果可用情况下执行）

## 性能指标
* Label:定义的HTTP请求名称
* Samples:表示这次测试中一共发出了多少个请求
* Average:访问页面的平均响应时间 
* Min:访问页面的最小响应时间
* Max:访问页面的最大响应时间
* Error%:错误的请求的数量/请求的总数
* Throughpu:每秒完成的请求数
* KB/Sec:每秒从服务器端接收到的数据量
* Median:50％的用户响应时间
* 90%Line:90％的用户响应时间
* 95%Line:95％的用户响应时间
* 99%Line:99％的用户响应时间
时间指标的单位都是毫秒。

## 第一个web性能测试
我做了一个博客网站首页的性能测试，只设置ThreadGroup,Sampler,Listener三项就可以运行。

#### ThreadGroup设置
一个性能测试请求负载是基于一个线程组完成的，jmeter中每个测试计划至少需要包含一个线程组。Test Plan右键菜单可新增ThreadGroup(add->Threads->ThreadGroup);
![ThreadGroup](/img/jmeter-3.png)
* Number of Threads 线程数:虚拟用户数.一个虚拟用户占用一个进程或线程。
* Ramp-up Period 准备时长:设置的虚拟用户数需要多长时间全部启动。
* Loop Count 循环次数：每个线程发送请求的次数。

#### Sample设置
在ThreadGroup上右键菜单可新增HttpRequest（add->Sampler->HttpRequest).Sampler是与服务器进行交互的单元.一个Sampler通常进行三部分的工作：
* 向服务器发送请求
* 记录服务器的响应数据
* 记录相应时间信息
![HttpRequest](/img/jmeter-4.png)

#### Listener设置
脚本的主要部分设置完成后,需要通过某种方式获得性能测试中的测试结果。ThreadGroup上右键菜单可新增Listner（add->Listener->Aggregate Report).
![HttpRequest](/img/jmeter-5.png)
我最关心的是我的博客响应时间，数据显示客户的平均响应时间为:337毫秒,99%的用户在1985毫秒内完成，也就不超2秒。最少用户响应时间为149毫秒，最大用户响应时间为5020毫秒
